<!-- build time:Fri Sep 18 2020 10:54:26 GMT+0800 (中国标准时间) --><!DOCTYPE html><html class="theme-next pisces use-motion" lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="theme-color" content="#222"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css"><link rel="apple-touch-icon" sizes="180x180" href="/images/mlxn.png?v=5.1.4"><link rel="icon" type="image/png" sizes="32x32" href="/images/mlxn.png?v=5.1.4"><link rel="icon" type="image/png" sizes="16x16" href="/images/mlxn.png?v=5.1.4"><link rel="mask-icon" href="/images/mlxn.png?v=5.1.4" color="#222"><meta name="keywords" content="深度学习,目标检测,"><link rel="alternate" href="/atom.xml" title="IronSublimate" type="application/atom+xml"><meta name="description" content="CenterNet源码分析侯德柱CenterNet源代码概述srcsrc&#x2F;main.py主函数src&#x2F;demo.py展示测试结果图片src&#x2F;test.py测试数据src&#x2F;libsrc&#x2F;lib&#x2F;opts.py解析参数src&#x2F;lib&#x2F;llogger.pysrc&#x2F;lib&#x2F;datasets数据集文件夹src&#x2F;lib&#x2F;datasets&#x2F;dataset实现加载哪个数据集，其每一个子类为数据集名字src&#x2F;lib"><meta property="og:type" content="article"><meta property="og:title" content="CenterNet代码分析"><meta property="og:url" content="https://ironsublimate.github.io/2020/09/14/27078/index.html"><meta property="og:site_name" content="IronSublimate"><meta property="og:description" content="CenterNet源码分析侯德柱CenterNet源代码概述srcsrc&#x2F;main.py主函数src&#x2F;demo.py展示测试结果图片src&#x2F;test.py测试数据src&#x2F;libsrc&#x2F;lib&#x2F;opts.py解析参数src&#x2F;lib&#x2F;llogger.pysrc&#x2F;lib&#x2F;datasets数据集文件夹src&#x2F;lib&#x2F;datasets&#x2F;dataset实现加载哪个数据集，其每一个子类为数据集名字src&#x2F;lib"><meta property="og:locale" content="zh_CN"><meta property="article:published_time" content="2020-09-14T13:53:48.000Z"><meta property="article:modified_time" content="2020-09-14T14:04:53.347Z"><meta property="article:author" content="侯德柱"><meta property="article:tag" content="深度学习"><meta property="article:tag" content="目标检测"><meta name="twitter:card" content="summary"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Pisces",version:"5.1.4",sidebar:{position:"left",display:"always",offset:12,b2t:!1,scrollpercent:!0,onmobile:!1},fancybox:!0,tabs:!0,motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},duoshuo:{userId:"0",author:"Author"},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><link rel="canonical" href="https://IronSublimate.github.io/2020/09/14/27078/"><title>CenterNet代码分析 | IronSublimate</title><meta name="generator" content="Hexo 4.2.1"></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN"><div class="container sidebar-position-left page-post-detail"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">IronSublimate</span> <span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle"></p></div><div class="site-nav-toggle"><button><span class="btn-bar"></span> <span class="btn-bar"></span> <span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br>Home</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br>Tags</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br>Categories</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br>Archives</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i><br>About</a></li></ul></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="https://IronSublimate.github.io/2020/09/14/27078/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="侯德柱"><meta itemprop="description" content=""><meta itemprop="image" content="/images/avatar.png"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="IronSublimate"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">CenterNet代码分析</h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">Posted on</span> <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-09-14T21:53:48+08:00">2020-09-14 </time><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i> </span><span class="post-meta-item-text">Post modified&#58;</span> <time title="Post modified" itemprop="dateModified" datetime="2020-09-14T22:04:53+08:00">2020-09-14 </time></span><span class="post-meta-divider">|</span> <span class="page-pv"><i class="fa fa-file-o"></i> <span class="busuanzi-value" id="busuanzi_value_page_pv"></span></span></div></header><div class="post-body" itemprop="articleBody"><h1 id="centernet源码分析">CenterNet源码分析</h1><blockquote><p>侯德柱<br><a href="https://github.com/xingyizhou/CenterNet" target="_blank" rel="noopener">CenterNet源代码</a></p></blockquote><h2 id="概述">概述</h2><ol type="1"><li><p>src</p><ol type="1"><li><p>src/main.py主函数</p></li><li><p>src/demo.py展示测试结果图片</p></li><li><p>src/test.py测试数据</p></li></ol></li><li><p>src/lib</p><ol type="1"><li>src/lib/opts.py解析参数</li><li>src/lib/llogger.py</li><li>src/lib/datasets数据集文件夹<ol type="1"><li>src/lib/datasets/dataset实现加载哪个数据集，其每一个子类为数据集名字</li><li>src/lib/datasets/sample如何对数据采样，针对不同的网络返回什么信息，每一个子类为对应的网络名字</li></ol></li><li>src/lib/detectors检测方法集文件夹，包括如何训练，如何检测参数</li><li>src/lib/external实现nms？</li><li>src/lib/models基本网络结构，如dla、resnet、hourglass等</li><li>src/lib/trains实现trainer，网络结构构建</li></ol></li><li><p>src/tools数据集预处理<a id="more"></a> ## 命令行参数</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">opt.num_stacks = <span class="number">2</span> <span class="keyword">if</span> opt.arch == <span class="string">'hourglass'</span> <span class="keyword">else</span> <span class="number">1</span></span><br></pre></td></tr></table></figure>## 简称<p></p></li></ol><ul><li>res : resolution</li><li>crop裁剪</li><li>reg_loss : regression loss</li></ul><h2 id="自定义数据集">自定义数据集</h2><ol type="1"><li>复制一个新建一个子类，继承data.Dataset</li><li>计算所有的图片的均值和标准差，并修改class.mean、class.std</li><li>class.num_class改为自己数据集的类别数</li><li>default_resolution为默认的分辨率</li><li>修改读取json文件的路径</li><li>修改self.class_name和self._valid_ids</li><li>将数据集加入src/lib/datasets/dataset_factory</li><li>在/src/lib/opts.py文件中修改self.parser.add_argument('--dataset'</li><li>修改src/lib/utils/debugger.py<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#（1）第45行下方加入两行：</span></span><br><span class="line"><span class="keyword">elif</span> num_classes == <span class="number">6</span> <span class="keyword">or</span> dataset == <span class="string">'food'</span>:</span><br><span class="line">    self.names = food_class_name</span><br><span class="line"><span class="comment"># （2）第460行下方加入自己所定义的类别，不包含背景：</span></span><br><span class="line">food_class_name = [<span class="string">'aaa'</span>, <span class="string">'bbb'</span>, <span class="string">'ccc'</span>, <span class="string">'ddd'</span>, <span class="string">'eee'</span>, <span class="string">'fff'</span>]</span><br></pre></td></tr></table></figure></li></ol><h2 id="自定义网络">自定义网络</h2><h3 id="srclibdatasetsample">src/lib/dataset/sample</h3><p>重写__getItem__</p><h3 id="自定义基础网络结构srclibmodel">自定义基础网络结构src/lib/model</h3><p>继承nn.Module，实现forward。不包括loss</p><h2 id="srclibmodels">src/lib/models</h2><h3 id="model.py">model.py</h3><ul><li><p>create_model</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">create_model</span><span class="params">(arch: str, heads: Dict[str, int], head_conv: int)</span> -&gt; nn.Module:</span></span><br></pre></td></tr></table></figure><p>所有基本网络结构的get_model参数与本函数一致</p><ul><li><p>参数</p><ul><li><p>arch网络架构 命令行参数--arch确定</p></li><li><p>heads opt.heads确定，key为特征名字，value为值</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">elif</span> opt.task == <span class="string">'ctdet'</span>:</span><br><span class="line">    <span class="comment"># assert opt.dataset in ['pascal', 'coco']</span></span><br><span class="line">    opt.heads = &#123;<span class="string">'hm'</span>: opt.num_classes,</span><br><span class="line">                 <span class="string">'wh'</span>: <span class="number">2</span> <span class="keyword">if</span> <span class="keyword">not</span> opt.cat_spec_wh <span class="keyword">else</span> <span class="number">2</span> * opt.num_classes&#125;</span><br><span class="line">    <span class="keyword">if</span> opt.reg_offset:</span><br><span class="line">        opt.heads.update(&#123;<span class="string">'reg'</span>: <span class="number">2</span>&#125;)</span><br></pre></td></tr></table></figure></li><li><p>head_conv 命令行参数--head_conv 确定 output head的卷积层通道数 0 没有卷积层，-1默认:resnet64,dla256</p></li></ul></li><li><p>返回值</p><ul><li>基本网络架构</li></ul></li></ul></li></ul><h3 id="networks">networks</h3><p>forward返回值</p><h4 id="resnet_dcn.py">resnet_dcn.py</h4><h5 id="poseresnet">PoseResNet</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PoseResNet</span><span class="params">(nn.Module)</span>:</span></span><br></pre></td></tr></table></figure><ul><li><p>__init__</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, block: Type[BasicBlock], layers: List[int, int, int, int], heads: Dict[str, int], head_conv: int)</span>:</span></span><br></pre></td></tr></table></figure><ul><li><p>成员变量</p><ul><li><p>self.head是字典，key为分支名称(hm,wh,reg)，value为最后输出的通道数=数据集类别数</p></li><li><p>构造函数最后根据head的key，用__setattr__把key设成属性名，成员变量的值是卷积层的model，输入256通道，输出数据集类别数通道</p></li></ul></li></ul></li><li><p>forward</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, x: torch.Tensor)</span> -&gt; List[Dict[str, torch.Tensor]]</span></span><br></pre></td></tr></table></figure><ul><li>返回值中每一个元素是head不同key的全连接层对应前向传播的结果，list的长度为1<ol type="1"><li>hm：热力图size=(1,2,128,128)为 (batch size ,num of classes, H/R,W/R)</li><li>wh：宽高size=(1,2,128,128)为 (batch size ,2, H/R,W/R)</li><li>reg：回归误差size=(1,2,128,128)为 (batch size ,2, H/R,W/R)</li></ol></li></ul></li></ul><h3 id="losses">losses</h3><h4 id="regl1loss">RegL1Loss</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RegL1Loss</span><span class="params">(nn.Module)</span>:</span></span><br></pre></td></tr></table></figure><ul><li>__init__</li><li>forward<ul><li>中间变量<ul><li>pred size=(1,128,2)</li><li>mask size=(1,128,2)</li></ul></li></ul></li></ul><h2 id="srclibtrains">src/lib/trains</h2><h3 id="modelwithloss">ModelWithLoss</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ModelWithLoss</span><span class="params">(torch.nn.Module)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, model: torch.nn.Module, loss: torch.nn.Module)</span>:</span></span><br><span class="line">        super(ModelWithLoss, self).__init__()</span><br><span class="line">        self.model = model</span><br><span class="line">        self.loss = loss</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, batch: dict)</span> -&gt; (Dict[str, torch.Tensor], torch.Tensor, Dict[str, torch.Tensor]):</span></span><br><span class="line">        outputs = self.model(batch[<span class="string">'input'</span>])</span><br><span class="line">        loss, loss_stats = self.loss(outputs, batch)</span><br><span class="line">        <span class="keyword">return</span> outputs[<span class="number">-1</span>], loss, loss_stats</span><br></pre></td></tr></table></figure><p>outputs为network的输出，List[Dict[str, torch.Tensor]]</p><p>model为网络前向传播的输出，不包括loss</p><p>返回值</p><ul><li>loss Tensor标量</li><li>loss_stats</li></ul><h3 id="basetrainer">BaseTrainer</h3><ul><li><p>__init__</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, opt: Namespace, model: torch.nn.Module, optimizer: Optional[torch.optim.Adam] = None)</span>:</span></span><br></pre></td></tr></table></figure><ul><li>opt为命令行参数</li><li>model为src/lib/model中定义的model</li><li>optimizer为优化器，main.py中用的adam</li><li>self.loss_stats, self.loss = self._get_losses(opt)</li><li>self.model_with_loss = ModelWithLoss</li></ul></li><li><p>run_epoch</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run_epoch</span><span class="params">(self, phase: str, epoch: int, data_loader: torch.utils.data.DataLoader)</span></span></span><br></pre></td></tr></table></figure><ul><li>主要功能：<ol type="1"><li>对model_with_loss正向传播和反向传播，使用optimizer优化</li><li>计时</li><li>每5轮验证一次</li></ol></li><li>参数<ul><li>phase为'train'或'val'</li></ul></li><li>中间变量<ul><li>batch是dataloader返回的字典</li></ul></li><li>需要用到的成员函数<ul><li>opt<ul><li>task</li><li>exp_id</li></ul></li><li>model_with_loss</li></ul></li></ul></li><li><p>debug</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">debug</span><span class="params">(self, batch: dict, output: List[Dict[str, torch.Tensor]], iter_id: int)</span>:</span></span><br></pre></td></tr></table></figure><p>需自己实现</p></li><li><p>save_result</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">save_result</span><span class="params">(self, output: Dict[str, torch.Tensor], batch: dict, results: dict)</span>:</span></span><br></pre></td></tr></table></figure><p>需自己实现</p><p>run_epoch中results传入的是空，results作为返回值</p></li><li><p>_get_loss</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_get_losses</span><span class="params">(self, opt: Namespace)</span> -&gt; (List[str], torch.nn.Module):</span></span><br></pre></td></tr></table></figure><p>需自己实现</p><ul><li>返回值<ul><li>List[str]是损失分量的名字</li></ul></li></ul></li><li><p>train &amp; val</p><p>分别调用run_epoch("train") run_epoch("val")</p></li></ul><h2 id="srclibdetectors">src/lib/detectors</h2><p>该类为检测类，使用训练好的模型检测</p><ul><li><p>pre_process</p><p></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pre_process(self, image: np.ndarray, scale: float, meta: Optional[list] = None) -&gt; (np.ndarray, dict)</span><br></pre></td></tr></table></figure>预处理，默认是实现图片放缩，meta在除ddd之外的检测器没用<p></p></li><li><p>process</p><p></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">process(self, images: torch.Tensor, return_time=False)-&gt; Tuple[dict, torch.Tensor, float]:</span><br></pre></td></tr></table></figure>必须自己实现<p></p><p>第一个dict为检测结果output，第二个Tensor为检测结果的bbox和置信度等数据，需要自己实现[网络名]_decode函数在src/lib/models/decode.py中，最后一个参数为检测开始时间，如果return_time=False则为0</p></li><li><p>post_process</p><p></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">post_process(self, dets: torch.Tensor, meta: dict, scale: float = 1) -&gt; Dict[int, Iterable]</span><br></pre></td></tr></table></figure>必须自己实现<p></p><p>反缩放，dets经[网络名]_post_process函数处理后返回检测框的信息（bbox，概率，类别）？</p></li><li><p>merge_outputs</p><p></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">merge_outputs(self, detections: List[Dict[int, Iterable]]) -&gt; Dict[int,np.ndarray]</span><br></pre></td></tr></table></figure>必须自己实现<p></p></li><li><p>debug</p><p></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">debug(self, debugger: Debugger, images: np.ndarray, dets: torch.Tensor, output, scale: float = <span class="number">1</span>)</span><br></pre></td></tr></table></figure>dets为detections的简写<p></p></li><li><p>show_results</p><p></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show_results(self, debugger: Debugger, image: np.ndarray, results: Dict[int, np.ndarray])</span><br></pre></td></tr></table></figure>显示测试结果的图片<p></p></li><li><p>以上这些函数会在基类中run函数调用</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">run(self, image_or_path_or_tensor: Union[str, np.ndarray, Dict[str, List[torch.Tensor]]], meta:Optional[list]=<span class="literal">None</span>):</span><br></pre></td></tr></table></figure><p></p></li></ul><p>，</p><h2 id="srclibutils">src/lib/utils</h2><h3 id="srclibutilsdebugger.py">src/lib/utils/debugger.py</h3><p>用于展示图片，</p><h3 id="srclibutilspost_process.py">src/lib/utils/post_process.py</h3><p>自定义检测完处理函数，整理检测结果</p><ul><li><p>ctdet_post_process</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctdet_post_process(dets: np.ndarray, c: Union[list, np.ndarray], s: Union[list, np.ndarray],h: int, w: int, num_classes: int) -&gt; List[Dict[int, Iterable]]:</span><br></pre></td></tr></table></figure></li></ul><p>dets: batch x max_dets x dim 批大小×最多检测出多少个×维度。在ctdet中，dim的大小为6，前4个参数为x1,y1,x2,y2；第5个参数为概率；第6个参数为类别</p><p>返回中的dict的key为类别，Iterable为np.nparray</p><h3 id="srclibutilsimage.py">src/lib/utils/image.py</h3><p>图像预处理</p><ul><li><p>transform_preds</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">transform_preds(coords: np.ndarray, center: np.ndarray,</span><br><span class="line">                    scale: Union[np.ndarray, list, int], output_size: Sequence)</span><br></pre></td></tr></table></figure><p>对点进行仿射变换</p><p>coords为坐标点的矩阵[[x0,y0],[x1,y1],...]，center中心，scale放大倍数，rot旋转，output_size输出尺寸为长度2的向量</p></li><li><p>get_affine_transform</p><p></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">get_affine_transform(center: np.ndarray,</span><br><span class="line">                         scale: Union[np.ndarray, list, int],</span><br><span class="line">                         rot: float,</span><br><span class="line">                         output_size: Sequence,</span><br><span class="line">                         shift=np.array([<span class="number">0</span>, <span class="number">0</span>], dtype=np.float32),</span><br><span class="line">                         inv=0) -&gt; np.ndarray:</span><br></pre></td></tr></table></figure><p></p><p>得到仿射变换矩阵，center中心，scale放大倍数，rot旋转，output_size输出尺寸为长度2的向量，</p></li><li><p>affine_transform</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">affine_transform(pt: np.ndarray, t: np.ndarray)</span><br></pre></td></tr></table></figure><p>pt长度为2的向量，t仿射变换矩阵</p></li><li><p>draw_msra_gaussian draw_umich_gaussian</p><p></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">draw_umich_gaussian(heatmap, center, radius, k=<span class="number">1</span>)</span><br></pre></td></tr></table></figure><p></p><p>TODO:</p></li><li><p>color_aug</p><p></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">color_aug(data_rng:int, image:np.ndarray, eig_val:np.ndarray, eig_vec:np.ndarray) -&gt; None</span><br></pre></td></tr></table></figure><p></p><p>图片增强，直接在原图像上修改</p><ul><li>data_rng为随机数种子，默认np.random.RandomState(123)</li><li>image归一化的图片</li><li>eig_val default = np.array([0.2141788, 0.01817699, 0.00341571], dtype=np.float32)</li><li>eig_vec default = np.array([ [-0.58752847, -0.69563484, 0.41340352], [-0.5832747, 0.00994535, -0.81221408], [-0.56089297, 0.71832671, 0.41158938] ], dtype=np.float32)</li></ul></li><li><p>draw_dense_reg</p><p></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">draw_dense_reg(regmap, heatmap, center, value, radius, is_offset=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure><p></p></li></ul><h2 id="cocoapi">COCOAPI</h2><ul><li><p>COCO.loadImgs</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">loadImgs(self, ids:Union[int,Sequence]=[])-&gt;List[dict]</span><br></pre></td></tr></table></figure><p>返回图片文件名等信息</p><p>e.g.</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">"license"</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="attr">"file_name"</span>: <span class="string">"000000324158.jpg"</span>,</span><br><span class="line">        <span class="attr">"coco_url"</span>: <span class="string">"http://images.cocodataset.org/val2017/000000324158.jpg"</span>,</span><br><span class="line">        <span class="attr">"height"</span>: <span class="number">334</span>,</span><br><span class="line">        <span class="attr">"width"</span>: <span class="number">500</span>,</span><br><span class="line">        <span class="attr">"date_captured"</span>: <span class="string">"2013-11-19 23:54:06"</span>,</span><br><span class="line">        <span class="attr">"flickr_url"</span>: <span class="string">"http://farm1.staticflickr.com/169/417836491_5bf8762150_z.jpg"</span>,</span><br><span class="line">        <span class="attr">"id"</span>: <span class="number">324158</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure></li><li><p>COCO.getAnnIds</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">getAnnIds(self, imgIds:List[int]=[], catIds:List[int]=[], areaRng:List[float]=[], iscrowd:bool=None)-&gt;List[int]</span><br></pre></td></tr></table></figure><p>e.g.</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">10673</span>, <span class="number">345846</span>, <span class="number">349287</span>, <span class="number">351168</span>, <span class="number">353731</span>, <span class="number">359808</span>, <span class="number">638724</span>, <span class="number">1192678</span>, <span class="number">1194317</span>, <span class="number">1341598</span>, <span class="number">1346450</span>, <span class="number">1348862</span>, <span class="number">2038341</span>, <span class="number">2044744</span>, <span class="number">2162813</span>]</span><br></pre></td></tr></table></figure></li><li><p>COCO.loadAnns</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">loadAnns(self, ids=[])-&gt;List[dict]</span><br></pre></td></tr></table></figure><p>加载标记，</p><p>e.g.</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        'segmentation': [[</span><br><span class="line">            44.2, 167.74, 48.39, 162.71, 66.87, 161.19, 72.75, 162.71, 80.98, 164.22, 80.14, 168.92, 78.12, 168.58, 72.24, 170.94, 71.74, 173.79, 54.27, 174.97, 52.59, 170.1, 50.75, 167.91, 45.71, 168.92, 45.2, 167.58</span><br><span class="line">        ]], </span><br><span class="line">        'area': 331.9790999999998, </span><br><span class="line">        'iscrowd': 0, </span><br><span class="line">        'image_id': 324158, </span><br><span class="line">        'bbox': [44.2, 161.19, 36.78, 13.78], </span><br><span class="line">        'category_id': 3, </span><br><span class="line">        'id': 345846</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">    	...</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure></li><li></li></ul><h2 id="ctdet">ctdet</h2><h3 id="samplectdet.py">sample/ctdet.py</h3><h4 id="ctdetdataset.__getitem__">CTDetDataset.__getitem__</h4><blockquote><p>设原图片维度为W*H*3</p></blockquote><ul><li><p>CTDetDataset.__getitem__返回值</p><table><colgroup><col style="width:17%"><col style="width:11%"><col style="width:70%"></colgroup><thead><tr class="header"><th style="text-align:left">key</th><th>value</th><th>备注</th></tr></thead><tbody><tr class="odd"><td style="text-align:left">'input'</td><td>np.ndarray</td><td>输入图片shape=[3x512x512]</td></tr><tr class="even"><td style="text-align:left">'hm'</td><td>np.ndarray</td><td>heatmap size (num_classes, output_h, output_w), (80x128x128)(dtype=np.float32 正态分布，中心为bbox中心，w和h为bbox的w和h</td></tr><tr class="odd"><td style="text-align:left">'reg_mask'</td><td>np.ndarray</td><td>dtype=uint8 shape=[128] [1 1 1 1 1 1 0 0 ...]</td></tr><tr class="even"><td style="text-align:left">'ind'</td><td></td><td>dtype=int64 shape=[128] mask为1的地方有值</td></tr><tr class="odd"><td style="text-align:left">'wh'</td><td></td><td>dtyte=float32 shape=[128x2] mask为1的地方有值</td></tr><tr class="even"><td style="text-align:left">'dense_wh'</td><td></td><td></td></tr><tr class="odd"><td style="text-align:left">'dense_wh_mask'</td><td></td><td></td></tr><tr class="even"><td style="text-align:left">'cat_spec_wh'</td><td></td><td></td></tr><tr class="odd"><td style="text-align:left">'cat_spec_mask'</td><td></td><td></td></tr><tr class="even"><td style="text-align:left">'reg'</td><td></td><td>dtyte=float32 shape=[128x2] mask为1的地方有值，其他为0</td></tr><tr class="odd"><td style="text-align:left">'meta'</td><td>dict</td><td>见下方，非训练或debug时才有</td></tr></tbody></table><ul><li><p>meta</p><table><thead><tr class="header"><th>key</th><th>value type</th><th>备注</th></tr></thead><tbody><tr class="odd"><td>'c'</td><td>np.ndarray</td><td>仿射变换的center，(x,y)长度为2的向量，dtype=np.float32，默认为图片中心点</td></tr><tr class="even"><td>'s'</td><td>float</td><td>仿射变换的scale</td></tr><tr class="odd"><td>'gt_det'</td><td></td><td></td></tr><tr class="even"><td>'img_id'</td><td></td><td></td></tr></tbody></table></li></ul></li><li><p>变量</p><table><thead><tr class="header"><th>变量名</th><th>type</th><th>备注</th></tr></thead><tbody><tr class="odd"><td>inp</td><td>np.ndarray</td><td>input输入图片，80行transpose(2,0,1)将其变为3*W*H</td></tr><tr class="even"><td>num_objs</td><td>int</td><td>图像中标记的矩形框数量和self.max_objs最小值</td></tr><tr class="odd"><td></td><td></td><td></td></tr><tr class="even"><td>opt.no_color_aug</td><td>bool</td><td>default=False <strong>不</strong>进行色彩增强，默认增强</td></tr><tr class="odd"><td>opt.keep_res</td><td>bool</td><td>default=False保持分辨率</td></tr><tr class="even"><td>opt.flip</td><td>float</td><td>图片翻转概率</td></tr><tr class="odd"><td>opt.down_ratio</td><td>int</td><td>default=4 下采样率</td></tr><tr class="even"><td>opt.dense_wh</td><td>bool</td><td>default=False 中心点附件加权回归或中心点回归</td></tr><tr class="odd"><td></td><td></td><td></td></tr><tr class="even"><td></td><td></td><td></td></tr><tr class="odd"><td></td><td></td><td></td></tr></tbody></table><ul><li><p>input image(inp)</p><ul><li>39行cv2.imread</li><li>68行opt.flip按概率翻转</li><li>73行仿射变换</li><li>76行归一化（÷255）</li><li>79行变正态分布</li><li>80行transpose(2,0,1)将其维度变为3*W*H</li><li>最后作为res['inp']返回</li></ul></li><li><p>bbox为目标矩形框</p><ul><li>102行转为x1,y1,x2,y2</li><li>105行根据图像翻转</li><li>106行仿射变换</li><li>108行裁剪使其不超过图片的边界</li><li>bbox用来生成heatmap，返回值中没有bbox</li></ul></li><li><p>heatmap</p><p>hm维度为num_classes×output_h×output_w</p><p>对于coco，num_classes=80。output_h×output_w 默认为输入图片的高宽分别除以4</p><p>dtype=np.float32</p><p>如果bbox中没有对应的类别，则该类的heatmap为0</p><p>由image.py中gaussian_radius和</p></li></ul></li></ul><h4 id="其他函数">其他函数</h4><ul><li><p>CTDetDataset._coco_box_to_bbox</p><p></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">_coco_box_to_bbox(self, box:Sequence)-&gt;np.ndarray</span><br></pre></td></tr></table></figure><p></p><p>将(x,y.w,h)变为(x1,y1,x2,y2)，左上和右下的坐标</p></li></ul><h3 id="trainsctdet.py">trains/ctdet.py</h3><h4 id="ctdetloss">CtdetLoss</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CtdetLoss</span><span class="params">(torch.nn.Module)</span>:</span></span><br></pre></td></tr></table></figure><ul><li><p>__init__</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, opt)</span>:</span></span><br></pre></td></tr></table></figure><ul><li>成员变量<ul><li>self.crit是一个heatamp损失函数，返回值为torch.Tensor标量</li><li>self.crit_hw是长宽损失函数</li><li>self.crit_reg是修正误差损失函数</li></ul></li></ul></li><li><p>forward</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, batch: dict)</span> -&gt; (object, torch.Tensor, Dict[str, torch.Tensor]):</span></span><br></pre></td></tr></table></figure><ul><li>参数<ul><li>batch是dataloader __getitem__的返回值</li></ul></li><li>返回值<ul><li>outputs是model/network中前向传播的返回值</li><li>loss是标量torch.Tensor</li><li>loss_stats是字典，损失分量的名字为key和其数值的Tensor为value</li></ul></li></ul></li></ul><h4 id="ctdettrainer">CtdetTrainer:</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CtdetTrainer</span><span class="params">(BaseTrainer)</span>:</span></span><br></pre></td></tr></table></figure><h3 id="section"></h3><h2 id="test.py">test.py</h2><h3 id="输出">输出</h3><h4 id="bar.suffix">Bar.suffix</h4><p>[当前轮数/总轮数]|Tot:总时间|ETA:剩余时间|tot总时间|load载入时间|pre预处理时间|net|dec|post|merge|</p></div><div><ul class="post-copyright"><li class="post-copyright-author"><strong>Post author:</strong> 侯德柱</li><li class="post-copyright-link"><strong>Post link:</strong> <a href="https://ironsublimate.github.io/2020/09/14/27078/" title="CenterNet代码分析">https://ironsublimate.github.io/2020/09/14/27078/</a></li><li class="post-copyright-license"><strong>Copyright Notice: </strong>All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/" rel="external nofollow" target="_blank">CC BY-NC-SA 3.0</a> unless stating additionally.</li></ul></div><footer class="post-footer"><div class="post-tags"><a href="/tags/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/" rel="tag"><i class="fa fa-tag"></i> 深度学习</a> <a href="/tags/%E7%9B%AE%E6%A0%87%E6%A3%80%E6%B5%8B/" rel="tag"><i class="fa fa-tag"></i> 目标检测</a></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/2020/09/14/42787/" rel="next" title="C语言补充"><i class="fa fa-chevron-left"></i> C语言补充</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"><a href="/2020/09/14/33845/" rel="prev" title="联合注意-联合激励代码分析">联合注意-联合激励代码分析 <i class="fa fa-chevron-right"></i></a></div></div></footer></div></article><div class="post-spread"></div></div></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span> <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span> <span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">Table of Contents</li><li class="sidebar-nav-overview" data-target="site-overview-wrap">Overview</li></ul><section class="site-overview-wrap sidebar-panel"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" src="/images/avatar.png" alt="侯德柱"><p class="site-author-name" itemprop="name">侯德柱</p><p class="site-description motion-element" itemprop="description">这个人很懒，什么都没有写(´·＿·｀)</p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href="/archives/%7C%7C%20archive"><span class="site-state-item-count">5</span> <span class="site-state-item-name">posts</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/index.html"><span class="site-state-item-count">2</span> <span class="site-state-item-name">categories</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/index.html"><span class="site-state-item-count">3</span> <span class="site-state-item-name">tags</span></a></div></nav><div class="feed-link motion-element"><a href="/atom.xml" rel="alternate"><i class="fa fa-rss"></i> RSS</a></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/IronSublimate" target="_blank" title="GitHub"><i class="fa fa-fw fa-github"></i>GitHub</a> </span><span class="links-of-author-item"><a href="mailto:houyuxuan3120487@163.com" target="_blank" title="E-Mail"><i class="fa fa-fw fa-envelope"></i>E-Mail</a></span></div></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#centernet源码分析"><span class="nav-number">1.</span> <span class="nav-text">CenterNet源码分析</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#概述"><span class="nav-number">1.1.</span> <span class="nav-text">概述</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#自定义数据集"><span class="nav-number">1.2.</span> <span class="nav-text">自定义数据集</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#自定义网络"><span class="nav-number">1.3.</span> <span class="nav-text">自定义网络</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#srclibdatasetsample"><span class="nav-number">1.3.1.</span> <span class="nav-text">src&#x2F;lib&#x2F;dataset&#x2F;sample</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#自定义基础网络结构srclibmodel"><span class="nav-number">1.3.2.</span> <span class="nav-text">自定义基础网络结构src&#x2F;lib&#x2F;model</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#srclibmodels"><span class="nav-number">1.4.</span> <span class="nav-text">src&#x2F;lib&#x2F;models</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#model.py"><span class="nav-number">1.4.1.</span> <span class="nav-text">model.py</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#networks"><span class="nav-number">1.4.2.</span> <span class="nav-text">networks</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#resnet_dcn.py"><span class="nav-number">1.4.2.1.</span> <span class="nav-text">resnet_dcn.py</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#poseresnet"><span class="nav-number">1.4.2.1.1.</span> <span class="nav-text">PoseResNet</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#losses"><span class="nav-number">1.4.3.</span> <span class="nav-text">losses</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#regl1loss"><span class="nav-number">1.4.3.1.</span> <span class="nav-text">RegL1Loss</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#srclibtrains"><span class="nav-number">1.5.</span> <span class="nav-text">src&#x2F;lib&#x2F;trains</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#modelwithloss"><span class="nav-number">1.5.1.</span> <span class="nav-text">ModelWithLoss</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#basetrainer"><span class="nav-number">1.5.2.</span> <span class="nav-text">BaseTrainer</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#srclibdetectors"><span class="nav-number">1.6.</span> <span class="nav-text">src&#x2F;lib&#x2F;detectors</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#srclibutils"><span class="nav-number">1.7.</span> <span class="nav-text">src&#x2F;lib&#x2F;utils</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#srclibutilsdebugger.py"><span class="nav-number">1.7.1.</span> <span class="nav-text">src&#x2F;lib&#x2F;utils&#x2F;debugger.py</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#srclibutilspost_process.py"><span class="nav-number">1.7.2.</span> <span class="nav-text">src&#x2F;lib&#x2F;utils&#x2F;post_process.py</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#srclibutilsimage.py"><span class="nav-number">1.7.3.</span> <span class="nav-text">src&#x2F;lib&#x2F;utils&#x2F;image.py</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#cocoapi"><span class="nav-number">1.8.</span> <span class="nav-text">COCOAPI</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ctdet"><span class="nav-number">1.9.</span> <span class="nav-text">ctdet</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#samplectdet.py"><span class="nav-number">1.9.1.</span> <span class="nav-text">sample&#x2F;ctdet.py</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#ctdetdataset.__getitem__"><span class="nav-number">1.9.1.1.</span> <span class="nav-text">CTDetDataset.__getitem__</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#其他函数"><span class="nav-number">1.9.1.2.</span> <span class="nav-text">其他函数</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#trainsctdet.py"><span class="nav-number">1.9.2.</span> <span class="nav-text">trains&#x2F;ctdet.py</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#ctdetloss"><span class="nav-number">1.9.2.1.</span> <span class="nav-text">CtdetLoss</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ctdettrainer"><span class="nav-number">1.9.2.2.</span> <span class="nav-text">CtdetTrainer:</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#section"><span class="nav-number">1.9.3.</span> <span class="nav-text"></span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#test.py"><span class="nav-number">1.10.</span> <span class="nav-text">test.py</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#输出"><span class="nav-number">1.10.1.</span> <span class="nav-text">输出</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#bar.suffix"><span class="nav-number">1.10.1.1.</span> <span class="nav-text">Bar.suffix</span></a></li></ol></li></ol></li></ol></li></ol></div></div></section></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright">&copy; <span itemprop="copyrightYear">2020</span> <span class="with-love"><i class="fa fa-user"></i> </span><span class="author" itemprop="copyrightHolder">侯德柱</span></div><div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div><span class="post-meta-divider">|</span><div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div><div class="busuanzi-count"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="site-uv"><i class="fa fa-user"></i> <span class="busuanzi-value" id="busuanzi_value_site_uv"></span> </span><span class="site-pv"><i class="fa fa-eye"></i> <span class="busuanzi-value" id="busuanzi_value_site_pv"></span></span></div></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span id="scrollpercent"><span>0</span>%</span></div></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script><script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script></body></html><!-- rebuild by neat -->